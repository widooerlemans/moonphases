<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Upcoming Moon Phases</title>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: sans-serif;
      padding: 20px;
      text-align: center;
    }
    h2 {
      margin-bottom: 20px;
    }
    ul {
      list-style-type: none;
      padding-left: 0;
    }
    li {
      margin: 10px 0;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <h2>ðŸŒ˜ Next 4 Moon Phases</h2>
  <div id="moon-phases-container">Loading...</div>

<script>
(function() {
  // Moon phase names
  const phases = ["New Moon", "First Quarter", "Full Moon", "Third Quarter"];

  // Lunar cycle length in days
  const lunarCycle = 29.530588853;

  // Reference new moon date: Jan 6, 2000 18:14 UTC
  const knownNewMoon = new Date(Date.UTC(2000, 0, 6, 18, 14));

  // Calculate days since known new moon
  function daysSinceKnownNewMoon(date) {
    return (date - knownNewMoon) / (1000 * 60 * 60 * 24);
  }

  // Calculate moon phase (0 to 1)
  function moonPhase(date) {
    let days = daysSinceKnownNewMoon(date);
    let phase = (days % lunarCycle) / lunarCycle;
    return phase < 0 ? phase + 1 : phase;
  }

  // Find the next date for the target phase after currentDate
  function nextPhaseDate(currentDate, targetPhase) {
    let date = new Date(currentDate);
    const phaseLength = lunarCycle / 4;
    for (let i = 0; i < 30; i++) {
      let phase = moonPhase(date);
      // Check if current phase is within ~0.03 of target phase (about 1 day)
      let diff = Math.abs(phase - targetPhase);
      if(diff > 0.5) diff = 1 - diff; // wrap around
      if (diff < 0.03) {
        return date;
      }
      date.setDate(date.getDate() + 1);
    }
    return null; // fallback if not found within 30 days
  }

  // Format date nicely
  function formatDate(date) {
    return date.toLocaleString(undefined, {
      weekday: 'long',
      day: 'numeric',
      month: 'long',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      hour12: false
    });
  }

  // Map phases to target phase fraction
  const targetPhases = {
    "New Moon": 0,
    "First Quarter": 0.25,
    "Full Moon": 0.5,
    "Third Quarter": 0.75
  };

  const now = new Date();

  // Find the current moon phase index closest to today
  let currentPhaseValue = moonPhase(now);
  let currentPhaseIndex = 0;
  let smallestDiff = 1;
  for (let i = 0; i < phases.length; i++) {
    let diff = Math.abs(currentPhaseValue - targetPhases[phases[i]]);
    if(diff > 0.5) diff = 1 - diff; // wrap around
    if (diff < smallestDiff) {
      smallestDiff = diff;
      currentPhaseIndex = i;
    }
  }

  // Collect next 4 moon phases starting from current
  let results = [];
  let searchDate = new Date(now);
  for (let i = 0; i < 4; i++) {
    let phaseName = phases[(currentPhaseIndex + i) % phases.length];
    let phaseTarget = targetPhases[phaseName];
    let nextDate = nextPhaseDate(searchDate, phaseTarget);
    if (nextDate) {
      results.push({ name: phaseName, date: nextDate });
      // Start searching for next phase after this date + 1 day
      searchDate = new Date(nextDate);
      searchDate.setDate(searchDate.getDate() + 1);
    }
  }

  // Display the results
  const container = document.getElementById("moon-phases-container");
  if (container) {
    let html = "<ul>";
    results.forEach(phase => {
      html += `<li><strong>${phase.name}</strong> on ${formatDate(phase.date)}</li>`;
    });
    html += "</ul>";
    container.innerHTML = html;
  }
})();
</script>
</body>
</html>

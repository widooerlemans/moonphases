<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Upcoming Moon Phases</title>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: sans-serif;
      padding: 20px;
      text-align: center;
    }
    h2 {
      margin-bottom: 20px;
    }
    ul {
      list-style-type: none;
      padding-left: 0;
    }
    li {
      margin: 10px 0;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <h2>ðŸŒ˜ Next 4 Moon Phases</h2>
  <div id="moon-phases-container">Loading...</div>

<script>
(function() {
  const phases = ["New Moon", "First Quarter", "Full Moon", "Third Quarter"];
  const lunarCycle = 29.530588853;
  const knownNewMoon = new Date(Date.UTC(2000, 0, 6, 18, 14));

  function daysSinceKnownNewMoon(date) {
    return (date - knownNewMoon) / (1000 * 60 * 60 * 24);
  }

  function moonPhase(date) {
    let days = daysSinceKnownNewMoon(date);
    let phase = (days % lunarCycle) / lunarCycle;
    return phase < 0 ? phase + 1 : phase;
  }

  function nextPhaseDate(currentDate, targetPhase) {
    let date = new Date(currentDate);
    for (let i = 0; i < 30; i++) {
      let phase = moonPhase(date);
      let diff = Math.abs(phase - targetPhase);
      if(diff > 0.5) diff = 1 - diff;
      if (diff < 0.03) {
        return date;
      }
      date.setDate(date.getDate() + 1);
    }
    return null;
  }

  function formatDate(date) {
    return date.toLocaleString(undefined, {
      weekday: 'long',
      day: 'numeric',
      month: 'long',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      hour12: false
    });
  }

  const targetPhases = {
    "New Moon": 0,
    "First Quarter": 0.25,
    "Full Moon": 0.5,
    "Third Quarter": 0.75
  };

  const now = new Date();
  let results = [];
  let searchDate = new Date(now);

  while (results.length < 4) {
    let nextDates = phases.map(phaseName => ({
      name: phaseName,
      date: nextPhaseDate(searchDate, targetPhases[phaseName])
    })).filter(x => x.date !== null);

    if (nextDates.length === 0) break;

    nextDates.sort((a, b) => a.date - b.date);
    const nextPhase = nextDates[0];

    results.push(nextPhase);
    searchDate = new Date(nextPhase.date);
    searchDate.setDate(searchDate.getDate() + 1);
  }

  const container = document.getElementById("moon-phases-container");
  if (container) {
    let html = "<ul>";
    results.forEach(phase => {
      html += `<li><strong>${phase.name}</strong> on ${formatDate(phase.date)}</li>`;
    });
    html += "</ul>";
    container.innerHTML = html;
  }
})();
</script>
</body>
</html>
